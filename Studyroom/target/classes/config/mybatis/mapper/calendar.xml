<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CalendarMapper">
	<resultMap id="CalendarEventResultMap" type="calendar">
		<id property="id" column="id" />
		<result property="user_id" column="user_id" />
		<result property="type" column="type" />
		<result property="datetime" column="datetime" />
		<result property="del_flag" column="del_flag" />
		<result property="comment" column="comment" />
	</resultMap>

	<select id="getEventsByUserId" resultMap="CalendarEventResultMap">
		SELECT * FROM calendar_event WHERE user_id = #{user_id} AND del_flag = 0
	</select>

	<select id="getEventsByMonth" resultMap="CalendarEventResultMap">
		SELECT * FROM calendar_event WHERE user_id = #{user_id} AND EXTRACT(YEAR FROM datetime) = #{year} AND EXTRACT(MONTH FROM datetime) = #{month} AND del_flag = 0
	</select>
	
	<update id="deleteEvent">
        UPDATE calendar_event SET del_flag = -1 WHERE id = #{id}
    </update>
    
    <insert id="insertEvent" parameterType="map">
    INSERT INTO calendar_event ("ID", "USER_ID", "TYPE", "DATETIME", "COMMENT", "DEL_FLAG")
    VALUES (SEQ_CALENDAR_EVENT_ID.NEXTVAL, #{userId}, #{type}, TO_DATE(#{datetime}, 'YYYY-MM-DD HH24:MI:SS'), #{comment}, #{delFlag})
</insert>

<update id="updateEvent" parameterType="map">
    UPDATE calendar_event
    SET "TYPE" = #{type}, "COMMENT" = #{comment}
    WHERE "ID" = #{id} AND "DEL_FLAG" = 0
</update>

</mapper>